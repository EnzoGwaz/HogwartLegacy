<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Checklist Hogwarts Legacy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  https://cdn.jsdelivr.net/npm/@supabase/supabase-js</script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    input[type="checkbox"] { transform: scale(1.2); }
    select { margin: 10px; padding: 5px; }
  </style>
</head>
<body>
  <h1>Checklist Hogwarts Legacy</h1>

  <label for="typeFilter">Filtrer par Type :</label>
  <select id="typeFilter" onchange="filterTable()">
    <option value="">Tous</option>
    <option value="Principale">Principale</option>
    <option value="Secondaire">Secondaire</option>
    <option value="Collectible">Collectible</option>
  </select>

  <label for="statutFilter">Filtrer par Statut :</label>
  <select id="statutFilter" onchange="filterTable()">
    <option value="">Tous</option>
    <option value="À faire">À faire</option>
    <option value="En cours">En cours</option>
    <option value="Terminé">Terminé</option>
  </select>

  <table id="checklist">
    <thead>
      <tr>
        <th>✔</th>
        <th>Nom</th>
        <th>Type</th>
        <th>Statut</th>
        <th>Récompenses</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const SUPABASE_URL = 'https://tjecmmfpcsmnmlghbysr.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRqZWNtbWZwY3Ntbm1sZ2hieXNyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MDM2ODQsImV4cCI6MjA3NjA3OTY4NH0.hIaB_OUUBOCyFgmbPjHyEfHRqU-tRi8Uu4CRlq6T3g0';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function loadMissions() {
      const { data, error } = await supabase.from('missions').select('*');
      if (error) {
        console.error('Erreur chargement:', error);
        return;
      }

      const tbody = document.querySelector('#checklist tbody');
      tbody.innerHTML = '';

      data.forEach(mission => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="checkbox" ${mission.statut === 'Terminé' ? 'checked' : ''} onchange="updateStatut(${mission.id}, this.checked)" /></td>
          <td>${mission.nom}</td>
          <td>${mission.type}</td>
          <td>${mission.statut}</td>
          <td>${mission.recompenses}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function updateStatut(id, isChecked) {
      const newStatut = isChecked ? 'Terminé' : 'À faire';
      const { error } = await supabase.from('missions').update({ statut: newStatut }).eq('id', id);
      if (error) {
        console.error('Erreur mise à jour:', error);
      } else {
        loadMissions(); // recharge la table
      }
    }

    function filterTable() {
      const typeFilter = document.getElementById('typeFilter').value.toLowerCase();
      const statutFilter = document.getElementById('statutFilter').value.toLowerCase();
      const rows = document.querySelectorAll('#checklist tbody tr');

      rows.forEach(row => {
        const type = row.cells[2].textContent.toLowerCase();
        const statut = row.cells[3].textContent.toLowerCase();
        const show = (!typeFilter || type === typeFilter) && (!statutFilter || statut === statutFilter);
        row.style.display = show ? '' : 'none';
      });
    }

    loadMissions();
  </script>
</body>
</html>
